@inherits Custom.Hybrid.RazorTyped
@using AppCode
@using AppCode.System.SxcTables
@using AppCode.System.SxcTables.Data

@{
  Kit.Page.Activate("2sxc.JsCore");

  var itemViewId = MyPage.Parameters.String(SxcTablesConstants.UrlParamViewId, fallback: null);
  
  var item = string.IsNullOrEmpty(itemViewId) || !Guid.TryParse(itemViewId, out var parsedGuid)
    ? As<DataViewTableConfig>(MyItem)
    : App.Data.GetOne<DataViewTableConfig>(parsedGuid);
  
  var appUrl = App.Folder.Url;

  // Allow for path-to-customizers to be injected by a caller
  var useCustomizer = MyModel.Bool("useCustomizer", fallback: true);
  var pathToCustomizers = MyModel.String("pathToCustomizers", required: false)
    ?? "/dist/customizers.js";
  if (pathToCustomizers.StartsWith("/dist"))
    pathToCustomizers = appUrl + pathToCustomizers;
}

@* Show Switcher to toggle table configuration mode - to admins only, and not for demo since that shouldn't be modified *@
@Html.Partial("./ToggleViewConfigMode.cshtml", new { item })

<div class="d-flex justify-content-between align-items-center mb-1" @Kit.Toolbar.Default(item)>
  <h1>@item.Title</h1>
  @* The filter input will be dynamically inserted here by JavaScript *@
</div>

<div>
  @* Tabulator ID *@
  <div id="tosxc-table-@MyContext.Module.Id" />
</div>

@Kit.Page.TurnOn("window.table.createTabulatorTable()", data: new {
  tableName = "tosxc-table-" + MyContext.Module.Id,
  filterName = "tosxc-table-filter-" + MyContext.Module.Id,
  moduleId = MyContext.Module.Id,
  viewId = item.Guid.ToString()
})
@if (useCustomizer)
{
  <script src="@pathToCustomizers" @Kit.Page.AssetAttributes(position: "bottom")></script>
}
<script src="@appUrl/system/sxc-tables/dist/table.js" @Kit.Page.AssetAttributes(position: "bottom")></script>
<link href="@appUrl/system/sxc-tables/dist/styles.min.css" rel="stylesheet" @Kit.Page.AssetAttributes(position: "bottom")/>

@Html.Raw("<script src=\"https://cdn.jsdelivr.net/npm/@floating-ui/core@1.6.9\"></script>")
@Html.Raw("<script src=\"https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.6.13\"></script>")
@*

  - There are 2 ways of data loading implemented 1) Call with Promise 2) Let Tabulator AJAX load
  - The Code is related to the values of the app - when outsourced needs to be more generic
 
*@